{
  "name": "vagrant",
  "json_class": "Chef::Environment",
  "description": "Vagrant test environment",
  "NOTE": "NOTE key is ONLY for documenting this json data since json does not allow for comments. This data file is for using Vagrant instead of PXE booting like in production on bare-metal nodes.",
  "cookbook_versions": {},
  "chef_type": "environment",
  "override_attributes": {
    "chef-bcs": {
      "environment": "vagrant",
      "repo": {
        "NOTE": "Pins the current version of ceph or any other packaged in the array at the moment of install.",
        "packages": [
          {"name": "ceph", "version": "0.94.6-0.el7", "pin": true}
        ]
      },
      "bootstrap": {
        "name": "ceph-bootstrap",
        "env": "/home/vagrant/chef-bcs/environments",
        "interfaces": [
          {"name": "enp0s8", "ip": "10.121.1.2", "netmask": "255.255.255.0", "gateway": ""},
          {"name": "enp0s9", "ip": "10.121.2.2", "netmask": "255.255.255.0", "gateway": ""}
        ]
      },
      "adc": {
        "tag": "ceph-adc",
        "interface": "enp0s8",
        "stats": {
          "enable": true,
          "user": "haproxy",
          "passwd": "haproxy",
          "port": 1936
        },
        "bond": {
          "enable": false,
          "name": "bond0",
          "type": "Ethernet",
          "mtu": 1500,
          "interfaces": ["enp0s8", "enp0s9"],
          "options": "mode=4 miimon=100 xmit_hash_policy=layer2+3",
          "vbox_options": "mode=1 miimon=100 fail_over_mac=1",
          "nm_controlled": "no"
        },
        "connections": {
          "max": 8000,
          "balance": "roundrobin"
        },
        "ssl": {
          "path": "/etc/ssl/private"
        },
        "vip": {
          "prefix": "10.121.16.16",
          "netmask": "255.255.255.240",
          "cidr": 28,
          "port": {
            "ssl": 443,
            "non_ssl": 80
          }
        },
        "vips": [
          {"name": "admin", "ip": "10.121.16.17", "cidr": 28, "interface": "enp0s8", "ssl": false, "cert": "", "url": "s3.vagrant.admin.ceph.example.com"},
          {"name": "prod", "ip": "10.121.16.18", "cidr": 28, "interface": "enp0s8", "ssl": false, "cert": "s3.vagrant.ceph.example.com.crt", "url": "s3.vagrant.prod.ceph.example.com"},
          {"name": "dev", "ip": "10.121.16.19", "cidr": 28, "interface": "enp0s8", "ssl": false, "cert": "s3.vagrant.ceph.example.com.crt", "url": "s3.vagrant.dev.ceph.example.com"}
        ],
        "NOTE-VIP": "VIPS are 10.121.16.16/28 range (.17 - .30). Advertised via BGP",
        "bgp": {
          "enable": false,
          "asn": 65001,
          "interface": "enp0s8",
          "peers": [
            {"name": "bgp_peer1", "label": "Peer 1", "ip": "10.121.16.8"}
          ]
        },
        "backend": {
          "servers": [
            {"name": "ceph-vm1", "instance": "admin", "weight": 6, "port": 8080, "options": "check inter 2s rise 2 fall 3"},
            {"name": "ceph-vm1", "instance": "dev", "weight": 6, "port": 8081, "options": "check inter 2s rise 2 fall 3"},
            {"name": "ceph-vm1", "instance": "prod", "weight": 6, "port": 8082, "options": "check inter 2s rise 2 fall 3"},
            {"name": "ceph-vm2", "instance": "admin", "weight": 3, "port": 8080, "options": "check inter 2s rise 2 fall 3"},
            {"name": "ceph-vm2", "instance": "dev", "weight": 3, "port": 8081, "options": "check inter 2s rise 2 fall 3"},
            {"name": "ceph-vm2", "instance": "prod", "weight": 3, "port": 8082, "options": "check inter 2s rise 2 fall 3"}
          ],
          "NOTE-BES": "If not Federated then leave 'instance' empty and have only server name unique in the list instead of the way Federated requires the instance name to match the VIP name."
        }
      },
      "keepalived": {
        "passwd": "keepalived",
        "checks": true,
        "servers": [
          {"name": "ceph-vm1", "weight": 5, "interface": "enp0s8", "priority": 98, "router-id": 25},
          {"name": "ceph-vm2", "weight": 5, "interface": "enp0s8", "priority": 100, "router-id": 50},
          {"name": "ceph-vm3", "weight": 5, "interface": "enp0s8", "priority": 99, "router-id": 75}
        ]
      },
      "chef": {
        "owner": "vagrant",
        "group": "vagrant"
      },
      "security": {
        "sshd": {
          "permit_root_login": "no",
          "login_grace_time": "2m",
          "max_auth_tries": 6,
          "max_sessions": 10,
          "banner": "/etc/banner"
        },
        "firewall": {
          "interfaces": [
            {
              "name": "public",
              "ports": [
                {"role": "ceph-bootstrap", "open": [{"port": 123, "protocol": "udp"}, {"port": 80, "protocol": "tcp"}, {"port": 443, "protocol": "tcp"}, {"port": 67, "protocol": "udp"}, {"port": 69, "protocol": "udp"}, {"port": 21, "protocol": "tcp"}, {"port": 4011, "protocol": "udp"}, {"port": 53, "protocol": "udp"}], "ranges": [{"start": 25150, "end": 25152, "protocol": "tcp"}]},
                {"role": "ceph-mon", "open": [{"port": 6789, "protocol": "tcp"}], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "ceph-osd", "open": [], "ranges": [{"start": 6800, "end": 6872, "protocol": "tcp"}]},
                {"role": "ceph-rgw", "open": [8080], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "ceph-restapi", "open": [{"port": 5080, "protocol": "tcp"}], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "ceph-admin", "open": [], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "ceph-mds", "open": [], "ranges": [{"start": 6800, "end": 6872, "protocol": "tcp"}]},
                {"role": "ceph-rbd", "open": [], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "haproxy", "open": [{"port": 80, "protocol": "tcp"}, {"port": 443, "protocol": "tcp"},{"port": 1936, "protocol": "tcp"}], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "keepalived", "open": [{"port": 112, "protocol": "tcp"}], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]}
              ]
            },
            {
              "name": "cluster",
              "ports": [
                {"role": "ceph-osd", "open": [], "ranges": [{"start": 6800, "end": 6872, "protocol": "tcp"}]}
              ]
            }
          ],
        "NOTE1": "NOTE: Firewall open ports are accumulative for each node based on it's role. Role must match ceph-chef tags.",
        "NOTE2": "NOTE: Range start = 0 then range is skipped else put in exact ranges.",
        "NOTE3": "NOTE: OSDs start at 6800 and each OSD uses at least 3 ports. The end number should be high enough to account for this. MDS should match OSD.",
        "NOTE4": "NOTE: If you run multiple instances of RGW then keep the port count in mind."
        }
      },
      "system": {
        "pid_max": 4194303
      },
      "ipmi": {
        "user": "vbox",
        "passwd": "$6$Salt$xvQkYaQ4urNWmnjpinAZSR/ZOaRy/aacKh4j18ayq/.mswLqleFZI5zaD1BCg2Fdzy1BjpBv9VIgVgt6YoA8T0",
        "NOTE": "password of vbox is: $6$Salt$xvQkYaQ4urNWmnjpinAZSR/ZOaRy/aacKh4j18ayq/.mswLqleFZI5zaD1BCg2Fdzy1BjpBv9VIgVgt6YoA8T0"
      },
      "cobbler": {
        "web_user": "cobbler",
        "pxe_interface": "enp0s3",
        "server": "10.121.1.2",
        "kickstart": {
          "NOTE": "password vagrant is: $6$Salt$6AyUczFy6SgV8A2wKAKfA9drpzrUsTGPJ3QjcWBbgS97BxBO.C7ZcBFALRiRkKfi9x8MK2SHet38BCQWS9LsR/",
          "root": {
            "passwd": "$6$Salt$6AyUczFy6SgV8A2wKAKfA9drpzrUsTGPJ3QjcWBbgS97BxBO.C7ZcBFALRiRkKfi9x8MK2SHet38BCQWS9LsR/",
            "passwd_type": "--iscrypted",
            "key": "ceph_bootstrap.pub"
          },
          "file": {
            "osd": "bcs_node_rhel_osd.ks",
            "nonosd": "bcs_node_rhel_nonosd.ks"
          },
          "bootloader": {
            "passwd": "",
            "passwd_type": ""
          },
          "users": [
            {
              "name": "vagrant",
              "passwd": "$6$Salt$6AyUczFy6SgV8A2wKAKfA9drpzrUsTGPJ3QjcWBbgS97BxBO.C7ZcBFALRiRkKfi9x8MK2SHet38BCQWS9LsR/",
              "passwd_type": "--iscrypted",
              "key": "ceph_bootstrap.pub",
              "shell": "/bin/bash",
              "comment": "Vagrant user",
              "groups": "wheel",
              "sudo": true
            },
            {
              "name": "operations",
              "passwd": "$6$Salt$3xxLPT099nzTbWkOS3CPNcar/zSLQ8BEgZdJk/AOkOb4V80sPepbraWcvrJvEEu6PswpKUw1WodWeiqRo1bw2/",
              "passwd_type": "--iscrypted",
              "key": "ceph_bootstrap.pub",
              "shell": "/bin/bash",
              "comment": "Operations user",
              "groups": "wheel",
              "sudo": true
            }
          ]
        },
        "profiles": [
          {"name": "ceph_osd_node", "file_type": "osd", "comment": "OSD type nodes either dedicated OSD or converged with other services like MON and RGW."},
          {"name": "ceph_non_osd_node", "file_type": "nonosd", "comment": "NON-OSD type nodes. Services like MON, RGW or MDS."}
        ],
        "servers": [
          {
            "name": "ceph-bootstrap",
            "roles": ["bootstrap", "adc"],
            "profile": "",
            "network": {
              "public": {
                "interface": "enp0s3",
                "mac": "08:00:27:E3:84:01",
                "ip": "10.121.1.3",
                "netmask": "255.255.255.0",
                "gateway": "10.121.1.2",
                "mtu": 1500
              },
              "cluster": {
                "interface": "enp0s8",
                "mac": "08:00:27:3E:CB:B0",
                "ip": "10.121.2.3",
                "netmask": "255.255.255.0",
                "gateway": "10.121.2.2",
                "mtu": 1500
              }
            }
          },
          {
            "name": "ceph-vm1",
            "roles": ["mon", "rgw", "osd", "adc", "admin"],
            "profile": "ceph_non_osd_node",
            "network": {
              "public": {
                "interface": "enp0s3",
                "mac": "08:00:27:E3:84:01",
                "ip": "10.121.1.3",
                "netmask": "255.255.255.0",
                "gateway": "10.121.1.2",
                "mtu": 1500
              },
              "cluster": {
                "interface": "enp0s8",
                "mac": "08:00:27:3E:CB:B0",
                "ip": "10.121.2.3",
                "netmask": "255.255.255.0",
                "gateway": "10.121.2.2",
                "mtu": 1500
              }
            }
          },
          {
            "name": "ceph-vm2",
            "roles": ["mon", "rgw", "osd", "adc", "admin"],
            "profile": "ceph_non_osd_node",
            "network": {
              "public": {
                "interface": "enp0s3",
                "mac": "08:00:27:EB:EC:61",
                "ip": "10.121.1.4",
                "netmask": "255.255.255.0",
                "gateway": "10.121.1.2",
                "mtu": 1500
              },
              "cluster": {
                "interface": "enp0s8",
                "mac": "08:00:27:C5:9F:40",
                "ip": "10.121.2.4",
                "netmask": "255.255.255.0",
                "gateway": "10.121.2.2",
                "mtu": 1500
              }
            }
          },
          {
            "name": "ceph-vm3",
            "roles": ["mon", "rgw", "osd", "adc", "admin"],
            "profile": "ceph_non_osd_node",
            "network": {
              "public": {
                "interface": "enp0s3",
                "mac": "08:00:27:8B:9F:3F",
                "ip": "10.121.1.5",
                "netmask": "255.255.255.0",
                "gateway": "10.121.1.2",
                "mtu": 1500
              },
              "cluster": {
                "interface": "enp0s8",
                "mac": "08:00:27:1B:3B:E7",
                "ip": "10.121.2.5",
                "netmask": "255.255.255.0",
                "gateway": "10.121.2.2",
                "mtu": 1500
              }
            }
          }
        ],
        "dhcp": {
          "shared_network": "bcs",
          "single": {
            "netmask": "255.255.255.0",
            "gateway": "10.121.1.2"
          },
          "subnets":[
            {"subnet": "10.121.1.0", "tag": "rack1", "dhcp_range": ["10.121.1.10", "10.121.1.254"], "netmask": "255.255.255.0", "router": "10.121.1.2"}
          ]
         },
        "NOTE1": "NOTE: Each subnet represents a routable rack so dhcp will need to manage each subnet with the TOR using IP-helper for dhcp requests by nodes in the given rack.",
        "NOTE2": "NOTE: You could just have one subnet for a single L2 span set of racks.",
        "NOTE3": "NOTE: /27 for subnet mask of each rack. DNS could be added to each subnet entry above but the global DNS entry below is good enough for this.",
        "partition_option": "ignoredisk --only-use=sda",
        "partitions": [
          {"part": "/boot", "fstype": "xfs", "size": 1024, "options": "--ondisk=sda"},
          {"part": "/", "fstype": "xfs", "size": 10000, "options": "--ondisk=sda"},
          {"part": "/var/lib", "fstype": "xfs", "size": 20000, "options": "--ondisk=sda"},
          {"part": "swap", "fstype": "swap", "size": 8000, "options": ""}
        ],
        "NOTE4": "NOTE: Partitions are for OSD nodes. All other partitions are coded into the given ks file.",
        "ports": {
          "http": 80,
          "https": 443,
          "xmlrpc": 25151
        },
        "os": {
          "name": "rhel-7.2",
          "version": "7.2",
          "arch": "x86_64",
          "distro": "rhel-server-7.2-x86_64-dvd.iso",
          "breed": "redhat"
        },
        "redhat": {
          "management": {
            "type": "off",
            "server": "xmlrpc.rhn.redhat.com",
            "key": "cloud-object-store"
          }
        },
        "repo_mirror": false
      },
      "ceph": {
        "cluster": "ceph",
        "repo": {
          "create": true,
          "version": {
            "name": "hammer",
            "branch": "stable",
            "revision": "0.el7",
            "number": "0.94.6",
            "arch": "x86_64"
          }
        },
        "config": {
          "NOTE": "This section is pure key/value. Meaning, the key and value are added to the given location in ceph.conf.",
          "global": {
            "rgw override bucket index max shards": 5
          },
          "mon": {
            "mon pg warn max per osd": 0,
            "mon osd full ratio": 0.90,
            "mon osd nearfull ratio": 0.80,
            "clock drift allowed": 15
          },
          "radosgw": {
            "cache max file size": 20000000
          }
        },
        "mon": {
          "port": 6789,
          "niceness": -10
        },
        "radosgw": {
          "port": 8080,
          "keystone": {
            "auth": false,
            "admin": {
              "token": "",
              "url": "",
              "port": 35357
            },
            "accepted_roles": "admin Member _member_",
            "token_cache_size": 1000,
            "revocation_interval": 1200
          },
          "rgw_num_rados_handles": 5,
          "civetweb_num_threads": 10
        },
        "osd": {
          "devices": [
            { "data": "/dev/sdb", "data_type": "hdd", "journal": "/dev/sdf", "journal_type": "ssd", "status": "" },
            { "data": "/dev/sdc", "data_type": "hdd", "journal": "/dev/sdf", "journal_type": "ssd", "status": "" },
            { "data": "/dev/sdd", "data_type": "hdd", "journal": "/dev/sdf", "journal_type": "ssd", "status": "" },
            { "data": "/dev/sde", "data_type": "hdd", "journal": "/dev/sdf", "journal_type": "ssd", "status": "" }
          ],
          "add": [],
          "remove": [],
          "NOTE-DEVICES1": "The 'add' and 'remove' above should reflect the same structure as 'devices' for maintenance.",
          "NOTE-DEVICES2": "The 'add' is only for temporary OSD devices you may need to add. If you need to add long-term devices then put them in 'devices' above and re-run the osd recipe.",
          "niceness": -10,
          "rebalance": false,
          "encrypted": false,
          "size": {
            "max": 3,
            "min": 2
          },
          "journal": {
            "size": 3000,
            "NOTE:": "Calculate min size (if you have space then use it): 2 * (#OSDs in node * 100MB/s) * 5 (default sync interval) = 2 * (3 * 100) * 5 = 3GB "
          },
          "crush": {
            "chooseleaf_type": 1
          }
        },
        "pools": {
          "active": ["radosgw"],
          "erasure_coding": {
            "profiles": [
              {"profile": "custom-default", "directory": "/usr/lib64/ceph/erasure-code", "plugin": "SHEC", "force": true, "key_value": {"k": 8, "m": 3}}
            ]
          },
          "radosgw": {
            "federated": {
              "enable": false,
              "instances": [
                {"name": "admin", "port": 8080},
                {"name": "dev", "port": 8081},
                {"name": "prod", "port": 8082}
              ],
              "regions": ["us"],
              "zones": ["01"],
              "NOTE": "You may have two zones but if the zones represent a datacenter then only use one for each environment(json) file that represents the given datacenter data."
            },
            "NOTE-NAME": "If federated then the system generated federated prefix will be added in front of the names below to create a fully federated pool name.",
            "names": [
              ".rgw",
              ".rgw.control",
              ".rgw.gc",
              ".rgw.root",
              ".users.uid",
              ".users.email",
              ".users.swift",
              ".users",
              ".usage",
              ".log",
              ".intent-log",
              ".rgw.buckets",
              ".rgw.buckets.index",
              ".rgw.buckets.extra"
            ],
            "NOTE-SETTINGS": "If federated then the settings below apply to the federated pools else the non-federated pools.",
            "settings": {
              "pg_num": 128,
              "pgp_num": 128,
              "options": "",
              "force": false,
              "calc": true,
              "size": 3,
              "crush_rule_set": 3,
              "chooseleaf": "host",
              "type": "replicated"
            },
            "remove": {
              "names": []
            }
          },
          "pgs": {
            "num": 128
          }
        },
        "restapi": {
          "port": 5080
        }
      },
      "domain_name" : "ceph.example.com",
      "network": {
        "public": {
          "interface": "enp0s8",
          "cidr": [
            "10.121.1.0/24"
          ],
          "mtu": 1500
        },
        "cluster": {
          "interface": "enp0s9",
          "cidr": [
            "10.121.2.0/24"
          ],
          "mtu": 1500
        }
      },
      "dns": {
        "servers": [ "8.8.8.8", "8.8.4.4" ]
      },
      "ntp": {
        "servers": [ "0.pool.ntp.org", "1.pool.ntp.org", "2.pool.ntp.org", "3.pool.ntp.org" ]
      },
      "collectd-plugins": {
        "write_graphite": {
          "node": {
            "id": "graphite",
            "host": "10.0.100.6",
            "port": 2013,
            "prefix": "collectd."
          }
        }
      }
    },
    "chef_client": {
      "server_url": "http://10.121.1.2:4000",
      "cache_path": "/var/chef/cache",
      "backup_path": "/var/chef/backup",
      "validation_client_name": "chef-validator",
      "run_path": "/var/chef"
    }
  }
}
