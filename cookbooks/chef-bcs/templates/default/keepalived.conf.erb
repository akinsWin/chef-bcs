################################################
# Auto generated
################################################

global_defs {
  router_id <%= node['hostname'] %>
#  weight <%= node['chef-bcs']['keepalived']['server']["#{node['hostname']}"]['weight']
}

vrrp_script chk_haproxy {
  script "killall -0 haproxy"
  interval 2
  weight 2
}

# Have an instance per VIP
vrrp_instance 100 {
  virtual_router_id 100

  # for electing MASTER, highest priority wins.
  priority  <%= node['chef-bcs']['keepalived']['servers']["#{node['hostname']}"]['priority'] %>
  state     MASTER

  interface <%= node['chef-bcs']['network']['public']['interface'] %>

  virtual_ipaddress {
    <%="#{node['chef-bcs']['management']['vip']}/#{(node['bcpc']['management']['cidr'].match /\d+\.\d+\.\d+\.\d+\/(\d+)/)[1].to_i}"%>
  }
  track_script {
<% if node['chef-bcs']['keepalived']['checks'] -%>
    chk_haproxy
<% end -%>
  }
  authentication {
    auth_type PASS
    auth_pass <%= node['chef-bcs']['keepalived']['passwd'] %>
  }
}


###########
global_defs {
  notification_email {
    root@rtp10-svc-4.cloud.cisco.com
  }
  notification_email_from keepalived@rtp10-svc-4.cloud.cisco.com
  smtp_server localhost
  smtp_connect_timeout 30
  router_id csm-a-aio-001
}

static_ipaddress {

}

vrrp_script haproxy {
  script   "killall -0 haproxy"
  interval 2
  weight   2
}
vrrp_instance 50 {
  virtual_router_id 50

  # Advert interval
  advert_int 1

  # for electing MASTER, highest priority wins.
  priority  100
  state     MASTER

  interface bond0

  virtual_ipaddress {

      10.207.240.5 dev bond0

  }

  track_script {
    haproxy
  }

}

vrrp_instance 51 {
  virtual_router_id 51

  # Advert interval
  advert_int 1

  # for electing MASTER, highest priority wins.
  priority  100
  state     MASTER

  interface bond0

  virtual_ipaddress {

      10.207.240.4 dev bond0


  }

  track_script {
    haproxy
  }

}


#########
global_defs {
  notification_email {
    root@rtp10-svc-4-medium01.cisco.com
  }
  notification_email_from keepalived@rtp10-svc-4-medium01.cisco.com
  smtp_server localhost
  smtp_connect_timeout 30
  router_id csl-a-proxyinternal-001
}

static_ipaddress {
}

vrrp_script haproxy {
  script   "killall -0 haproxy"
  interval 2
  weight   2
}
vrrp_instance 177 {
  virtual_router_id 177

  # Advert interval
  advert_int 1

  # for electing MASTER, highest priority wins.
  priority  100
  state     MASTER

  interface eth0

  virtual_ipaddress {
      10.207.236.177 dev eth0
  }

  track_script {
    haproxy
  }

}
vrrp_instance 178 {
  virtual_router_id 178

  # Advert interval
  advert_int 1

  # for electing MASTER, highest priority wins.
  priority  100
  state     MASTER

  interface eth0

  virtual_ipaddress {

      10.207.236.178 dev eth0


  }

  track_script {
    haproxy
  }


}
